---
settings:
  chains:
    relay_chain: &relay_chain
      wsPort: 9900
    assets_parachain: &assets_parachain
      wsPort: 9910
      paraId: &ap_id 1000
    trappist_parachain: &trappist_parachain
      wsPort: 9920
      paraId: &tp_id 2000
    penpal_parachain: &penpal_parachain
      wsPort: 9930
      paraId: &pp_id 3000
  variables:
    common:
      amount_to_send: &amount_to_send 5000000000000
      amount_to_buy_execution: &amount_to_buy_execution 1000000000000
    chains:
      relay_chain:
        signer: &rc_signer //Alice
        assets_parachain_destination: &ap_dest { v3: { parents: 0, interior: { x1: { parachain: *ap_id }}}}
        assets_parachain_dest_routed: &ap_dest_routed { v3: { parents: 1, interior: { x1: { parachain: *ap_id } }}}
        trappist_parachain_destination: &tp_dest { v3: { parents: 0, interior: { x1: { parachain: *tp_id }}}}
        trappist_parachain_dest_routed: &tp_dest_routed { v3: { parents: 1, interior: { x1: { parachain: *tp_id } }}}
        penpal_parachain_destination: &pp_dest { v3: { parents: 0, interior: { x1: { parachain: *pp_id }}}}
        penpal_parachain_dest_routed: &pp_dest_routed { v3: { parents: 1, interior: { x1: { parachain: *pp_id } }}}
      assets_parachain_account:
        signer: &ap_signer //Alice
        wallet: &ap_wallet HNZata7iMYWmk5RvZRTiAsSDhV8366zq2YGb3tLH5Upf74F
        bob_signer: &ap_bob_signer //Bob
        bob_wallet: &ap_bob_wallet FoQJpPyadYccjavVdTWxpxU7rUEaYhfLCPwXgkfD6Zat9QP
        asset_id: &asset_id 1
        assets_pallet_id: &assets_pallet_id 50
      trappist_parachain:
        signer: &tp_signer //Alice
        wallet: &tp_wallet 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
        bob_signer: &tp_bob_signer //Bob
        bob_wallet: &tp_bob_wallet 5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty
        sovereign_account: &tp_sovereign_sibl FBeL7EAeUroLWXW1yfKboiqTqVfbRBcsUKd6QqVf4kGBySS
        trappist_parachain_alice_account: &tp_alice_acc '0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d'
        trappist_parachain_bob_account: &tp_bob_acc '0x8eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a48'
      penpal_parachain:
        signer: &pp_signer //Alice
        wallet: &pp_wallet 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
        bob_wallet: &pp_bob_wallet 5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty
        penpal_parachain_bob_account: &pp_bob_acc '0x8eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a48'
  decodedCalls:
    system_remark_with_event:
      chain: *assets_parachain
      pallet: system
      call: remarkWithEvent
      args: [ 0x0011 ]

tests:
  - name: HRMP
    describes:
      - name: polkadotXcm.execute (Trappist) | Send tokens (xUSD) Trappist Parachain -> Penpal Parachain
        its:
          - name: Trappist Parachain should be able to reserve transfer an asset to Penpal Parachain
            actions:
              - extrinsics:
                - chain: *trappist_parachain
                  signer: *tp_bob_signer
                  pallet: polkadotXcm
                  call: execute
                  args: [
                    {
                      V3: [
                        {
                          WithdrawAsset: [
                            {
                              id: {
                                Concrete: {
                                  parents: 1,
                                  interior: {
                                    X3: [
                                      {
                                        Parachain: *ap_id
                                      },
                                      {
                                        PalletInstance: *assets_pallet_id
                                      },
                                      {
                                        GeneralIndex: *asset_id
                                      }
                                    ]
                                  }
                                }
                              },
                              fun: {
                                Fungible: *amount_to_send
                              }
                            }
                          ]
                        },
                        {
                          InitiateReserveWithdraw: {
                            assets: {
                              Wild: All
                            },
                            reserve: {
                              parents: 1,
                              interior: {
                                X1: {
                                  Parachain: *ap_id
                                }
                              }
                            },
                            xcm: [
                              {
                                BuyExecution: {
                                  fees: {
                                    id: {
                                      Concrete: {
                                        parents: 0,
                                        interior: {
                                          X2: [
                                            {
                                              PalletInstance: *assets_pallet_id
                                            },
                                            {
                                              GeneralIndex: *asset_id
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    fun: {
                                      Fungible: *amount_to_buy_execution
                                    }
                                  },
                                  weightLimit: Unlimited
                                }
                              },
                              {
                                DepositReserveAsset: {
                                  assets: {
                                    Wild: All
                                  },
                                  dest: {
                                    parents: 1,
                                    interior: {
                                      X1: {
                                        Parachain: *pp_id
                                      }
                                    }
                                  },
                                  xcm: [
                                    {
                                      DepositAsset: {
                                        assets: {
                                          Wild: All
                                        },
                                        beneficiary: {
                                          parents: 0,
                                          interior: {
                                            X1: {
                                              AccountId32: {
                                                network: null,
                                                id: *pp_bob_acc
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    },
                    10000000000, # maxWeight
                  ]
                  events:
                    - name: assets.Burned
                      chain: *assets_parachain
                    - name: assets.Issued
                      chain: *assets_parachain
                    - name: assets.Burned
                      chain: *trappist_parachain
                    - name: assets.Issued
                      chain: *penpal_parachain
